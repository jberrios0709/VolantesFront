<app-navbar></app-navbar>
<div class="content slide data fadeInAnimated fastAnimated"> 
  <div class="row">
    <div class="col-6 offset-md-1 text-left">
      <h4 class="title">Entregas y cobros</h4>
    </div>
  </div> 

  <div *ngIf="orders.lentgh === 0"><h1>Buscando data {{orders.lentgh}}</h1></div>
  <table class="table  table-hover" *ngIf="orders.lentgh != 0">
    <thead class="thead-dark">
      <tr>
        <th scope="col">Número de cliente</th>
        <th scope="col">Cliente</th>
        <th scope="col">Nombre del contacto</th>
        <th scope="col">Producto</th>
        <th scope="col">Cantidad</th>
        <th scope="col">Tiempo de entrega</th>
        <th scope="col">Modo de envío</th>
        <th scope="col">Deuda</th>
        <th scope="col">Modo de pago</th>
        <th scope="col">Opciónes</th>
      </tr>
    </thead>
    <tbody *ngIf="orders.length >= 1">
      <tr *ngFor="let order of orders; let i = index" class="fadeInAnimated" style="cursor:pointer" data-toggle="modal" data-target="#exampleModal" (click)="selectOrder(i)">
        <th scope="row">{{order.branch.client.id}}</th>
        <td>{{order.branch.client.name}}</td>
        <td>{{order.branch.client.name_contact}}</td>
        <td>{{order.product}}</td>
        <td>{{order.quantity}}</td>
        <td>{{order.date_delivery | date}}</td>
        <td>{{order.description_send}}</td>
        <td>{{calculateForIndex(i)}}</td>
        <td>{{order.method_payment}}</td>
        <td>
          <button type="button" class="btn" title="Imprimir">
            <i class="fas fa-print"></i>
          </button>
          <button type="button" class="btn" data-toggle="modal" data-target="#exampleModal" title="Entregar">
            <i class="fas fa-pencil-alt"></i>
          </button>
        </td>
      </tr>
    </tbody>
  </table>
    
   <!-- Modal -->
  <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header text-center">
          <h4 class="modal-title text-center" id="exampleModalLabel">Pago</h4>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body" *ngIf="show && !confirm">
          <form [formGroup]="forma">
            <div class="row">
              <div class="col-2 offset-md-4"><label>Deuda</label></div>
              <div class="col-4"><input type="text" [value]="calculate(1)" disabled ></div>
            </div>
            <div class="row">
              <div class="col-2 offset-md-4"><label>Abono</label></div>
              <div class="col-4"><label><input type="text" formControlName="mount"></label></div>
            </div>
            <div class="row">
              <div class="col-2 offset-md-4"><label>Restante</label></div>
              <div class="col-4"><label><input type="text" [value]="calculate(2)" disabled ></label></div>
            </div>
          </form>
        </div>
        <div class="modal-body text-center" *ngIf="show && confirm">
          <p *ngIf="calculate(1)==forma.value.mount && statusRequest == 'not'" style="font-weight:bold; color:black">
            De continuar la orden sera confirmada como pagada en su totalidad. <br> ¿Desea continuar?<br><br>
          </p>
          <p *ngIf="calculate(1)>forma.value.mount  && statusRequest == 'not'"  style="font-weight:bold; color:black">
            De continuar la orden quedara con un saldo deudor a favor de la compañia. <br> ¿Desea continuar?<br><br>
          </p>
          <button *ngIf="statusRequest == 'not'" type="button" class="btn btn-primary" (click)="createAbono()">Confirmar pago</button>
          <div style="margin-top:10px" *ngIf="statusRequest == 'send'">
            <i class="fas fa-spinner fa-spin"></i>
          </div>
          <div class="alert alert-success fade fastAnimated" role="alert" style="margin-top:10px" *ngIf="statusRequest == 'good'">
            Datos guardados exitosamente.
          </div>
          <div class="alert alert-danger fade fastAnimated" role="alert" style="margin-top:10px" *ngIf="statusRequest == 'error'">
            Error en la operacion.
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
          <button type="button" class="btn btn-success" *ngIf="!confirm" (click)="confirm = true">Pagar</button>
        </div>
      </div>
    </div>
  </div>


</div>
<app-footer></app-footer>

